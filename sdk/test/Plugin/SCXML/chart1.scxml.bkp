<scxml xmlns="http://www.w3.org/2005/07/scxml"
              version="1.0"
              initial="s1">
  <state id="s1" name="s1 name">
    <transition event="order.cancelled.manually" target="s16"/>
    <transition event="assessment.approved" target="s5"/>
    <initial>
      <transition target="s2"/>
    </initial>
    <state id="s2" name="pre flight assessment">
      <transition event="preflight.approved" target="s3"/>
    </state>
    <state id="s3" name="authenticating customer">
      <transition event="auth.approved" target="s4"/>
    </state>
    <final id="s4" name="risk scoring customer">
      <onentry>
        <script src="dna.enqueue_job_fetch_uc_report" />
      </onentry>
    </final>
  </state>
  <state id="s5" name="waiting for capture">
    <transition event="activated" target="s10"/>
    <initial>
      <transition target="s6"/>
    </initial>
    <state id="s6" name="waiting for capture">
      <onentry>
        <script src="checkout.promote_purchase_order" />
      </onentry>
      <transition event="purchase.capture.partially" target="s8"/>
      <transition event="purchase.capture.fully" target="s9"/>
      <transition event="purchase.cancelled.manually" target="s8"/>
    </state>
    <state id="s7" name="partially cancelled">
    </state>
    <state id="s8" name="captured partially">
      <transition event="purchase.capture.fully" target="s9"/>
      <transition event="purchase.cancelled.manually" target="s7"/>
    </state>
    <final id="s8" name="fully cancelled">
    </final>
    <final id="s9" name="captured fully">
    </final>
  </state>
  <state id="s10" name="Waiting for full payment or full return">
    <initial>
      <transition target="s11"/>
    </initial>
    <state id="s11" name="Waiting for payment">
      <transition event="fully_returned" target="fully_returned"/>
      <transition event="invoice.paid" target="s12"/>
    </state>
    <state id="s12" name="Paid">
      <transition event="fully_returned" target="fully_returned"/>
      <transition event="return_policy_over" target="s15"/>
      <transition event="returned.partial" target="s13"/>
    </state>
    <state id="s13" name="Paid with returned items">
      <transition event="fully_returned" target="s14"/>
      <transition event="return_policy_over" target="s15"/>
      <transition event="returned.fully" target="s14"/>
      <transition event="return_policy.timeout" target="s15"/>
    </state>
    <final id="s14" name="Fully returned">
    </final>
    <final id="s15" name="All done">
    </final>
  </state>
  <final id="s16" name="Order cancelled">
  </final>
</scxml>
